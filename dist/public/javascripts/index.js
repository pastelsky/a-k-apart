!function(){"use strict";function a(a,b,c){const d=new XMLHttpRequest;return!!d&&(d.onreadystatechange=function(){4===d.readyState&&200===d.status&&b(c?d.responseText:JSON.parse(d.responseText))},d.open("GET",a),void d.send())}function b(a){return document.querySelector(a)}function c(a){return document.querySelectorAll(a)}function d(a,b){for(var d=c(a),e=0;e<d.length;e++)b(d[e])}function e(a,b,c,e){d(b,function(b){b.addEventListener(a,c,e)})}function f(a,b){d(a,function(a){a.style.display=b||"block"})}function g(a){d(a,function(a){a.style.display="none"})}function h(a,b){d(a,function(a){a.classList.add(b)})}function i(a,b){d(a,function(a){a.classList.remove(b)})}function j(){return"speechSynthesis"in window&&"SpeechSynthesisUtterance"in window}function l(a){a&&this.updatePath(a),this.timer=null}function m(a){a?(f(".nav"),g(".intro"),g(".nav-start"),h(".ship","dock"),h(".story","dock")):(g(".nav"),f(".intro"),f(".nav-start"),i(".ship","dock"),i(".story","dock"),g(".map"),g(".path"))}function n(c,d){var x,y,z,A,B,C,k=b(".story h1"),o=b(".storyboard"),p=b(".control-right"),q=b(".control-left"),r=b(".date"),v=(b(".ship"),b(".map"),b(".controls"),b(".btn-start")),w=b(".portrait"),D=20,E=this;this.currentIndex=d||-1;var F=c.timeline;0===this.currentIndex&&(q.disabled=!0),n.setNavigationView=m,n.setNavigationStartView=function(a){var b=function(a){37===a.keyCode?E.prev():39===a.keyCode&&E.next()};a?(f(".nav-start"),g(".heading"),g(".nav-intro"),f(".map"),f(".path"),f(".journey"),i(".story","dock"),h(".wave","speed"),i(".ship","dock"),E.next(),q.disabled=!0,e("click",".control-left",function(){E.prev()}),e("click",".control-right",function(){E.next()}),document.addEventListener("keydown",b)):(g(".nav-start"),g(".map"),g(".journey"),f(".nav-intro"),f(".heading"),h(".ship","dock"),h(".story","dock"),i(".wave","speed"),E.prev(),document.removeEventListener("keydown",b))},this.init=function(){k.innerText=c.name,r.innerText=c.lifetime,o.innerText=c.about,v.style.display="block",w.style.backgroundImage='url("'+c.portrait+'")',a(c.path,function(a){document.body.insertAdjacentHTML("beforeend",a),n.setNavigationView(!0)},!0),e("click",".btn-start",this.start)},this.start=function(){x=b(".path path"),y=b(".path circle"),C=x.getBoundingClientRect(),A=C.left,B=new l(x.getAttribute("d")),z=0,B.start(D,E.updatePointer,!1,z,null),n.setNavigationStartView(!0)},this.updatePointer=function(a,b,d){console.log(d),h(".wave","speed"),Math.round(d)===c.stops[E.currentIndex]&&(B.stop(),i(".wave","speed"),z=Math.round(d));var e="translate("+a.x+"px,"+a.y+"px) rotate("+b+"deg)";y.style.transform=y.style.webkitTransform=e},this.next=function(){if(!(this.currentIndex>F.length-2)){this.currentIndex===F.length-2?p.disabled=!0:(p.disabled=!1,q.disabled=!1);var a=F[++this.currentIndex].caption,b=F[this.currentIndex].date;o.innerText=a,r.innerText=b,0!==this.currentIndex&&(console.log("stopping journey and starting at",this.currentIndex,c.stops[this.currentIndex]),B.stop(),B.start(D,E.updatePointer,!1,c.stops[this.currentIndex-1],null)),j()}},this.prev=function(){if(!(this.currentIndex<1)){1===this.currentIndex?q.disabled=!0:(q.disabled=!1,p.disabled=!1);var a=F[--this.currentIndex].caption,b=F[this.currentIndex].date;o.innerText=a,r.innerText=b,B.start(D,E.updatePointer,!0,c.stops[this.currentIndex+1],null),j()}}}function p(){function a(a){for(var b=0;b<o.length;b++)if(o[b].path===a)return o[b];return null}this.init=function(){var b=window.location.pathname,c=a(b),d=this;c&&c.onEnter(),e("click","[data-html5]",function(a){const b=a.target.closest("[data-html5]").getAttribute("href");d.push(b),a.preventDefault()}),window.onpopstate=function(){var b=window.location.pathname,c=a(b);c&&c.onEnter()}},this.push=function(b){var c=a(b);history.pushState(null,null,b),c.onEnter()}}var k=speechSynthesis.getVoices();console.log(k),l.prototype={start:function(a,b,c,d,e,f){if(this.stop(),this.percent=d||0,0==a)return!1;var g=this,h=new Date;!function i(){var k,j=[],l=new Date,m=(l-h)/1e3,n=m/a,o=100*n;return"function"==typeof f&&(o=100*f(n)),c?o=d-o:o+=d,g.running=!0,o>100||o<0?(g.stop(),e.call(g.context)):(g.percent=o,j[0]=g.pointAt(o-1),j[1]=g.pointAt(o+1),k=180*Math.atan2(j[1].y-j[0].y,j[1].x-j[0].x)/Math.PI,g.timer=requestAnimationFrame(i),void b.call(g.context,g.pointAt(o),k,g.percent))}()},stop:function(){cancelAnimationFrame(this.timer),this.timer=null,this.running=!1},pointAt:function(a){return this.path.getPointAtLength(this.len*a/100)},updatePath:function(a){this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.setAttribute("d",a),this.len=this.path.getTotalLength()}};var o=[{path:"/",onEnter:function(){m(!1)}},{path:"/vasco-da-gama",onEnter:function(){a("/public/data/vasco-da-gama.json",function(a){var b=new n(a);b.init()})}}],q=new p;q.init()}();
